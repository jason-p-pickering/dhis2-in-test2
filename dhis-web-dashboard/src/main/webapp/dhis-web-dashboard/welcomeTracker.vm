
<div>$navigationString</div>

<script>
    leftBar.hideAnimated();
</script>

#set( $mark = 0 )

<table>
    <tr valign="top">
		<td valign="top">
			<table valign="top">
				<tr bgcolor="#c0c0c0">
					<td align="center">$rootOrgUnitName</td>
					<td align="center">Registered</td>
					#foreach( $program in $programList )
					<td align="center">$program.name</td>
					#end
				</tr>
				#set( $count1 = 0 )
				#foreach( $orgUnit in $immChildrenList )
				<tr style="#if( $mark == 1 )background-color:#e0e0e0;#end" >
					<td><a href="index.action?drillDownOrgUnitId=$orgUnit.id">$orgUnit.shortName</a></td>
					<td align="center">$totalRegCountList.get( $count1 )</td>
					#foreach( $program in $programList )
					<td align="center">$totalEnrollCountMap.get( "$program.id:$orgUnit.id" )</td>
					#end
				</tr>
					#set( $count1 = $count1 + 1 )
					#if( $mark == 1 )
						#set( $mark = 0 )
					#else
						#set( $mark = 1 )
					#end    
				#end
                <tr bgcolor="#c0c0c0">
                    <td align="center">Total :</td>
                    <td align="center">$totalRegCount</td>
                    #foreach( $program in $programList )
                    <td align="center">$!totalEnrollCountMap.get( "$rootOrgUnitName:$program.id" )</td>
                    #end                    
                </tr>

			</table>
		</td>
		<td>&nbsp;&nbsp;&nbsp;</td>
		<td><div id="myChart"></div></td>
	</tr>
</table>

<script>

    Ext.require('Ext.chart.*');
    Ext.require('Ext.layout.container.Fit');
    
    Ext.onReady(function () 
    {
        var store = Ext.create('Ext.data.JsonStore', {
                        fields: ['facility', 
                                  #foreach( $program in $programList )
									'$program.name.replace(" ","")',
                                  #end
                                ],
                        data: [
                                #foreach( $orgUnit in $immChildrenList )
                                {facility: '$orgUnit.shortName', 
                                    #foreach( $program in $programList )
                                      $program.name.replace(" ",""): $totalEnrollCountMap.get( "$program.id:$orgUnit.id" ),
                                    #end
                                },
                                #end
                              ]
                    });
					
		Ext.define('Ext.chart.theme.Fancy', {
        extend: 'Ext.chart.theme.Base',

        constructor: function(config) {
            this.callParent([Ext.apply({
                axis: {
                    fill: "#789",
                    stroke: "#789"
                },
                axisLabelLeft: {
                    fill: "#789"
                },
                axisLabelBottom: {
                    fill: "#789"
                },
                axisTitleLeft: {
                    fill: "#789"
                },
                axisTitleBottom: {
                    fill: "#789"
                },
                colors: ["#307D7E", "#800000", "#347C2C", "#750B6A", "#806517"]
            }, config)]);
        }
    });			

        var panel1 = Ext.create('widget.panel', {
                        width: 600,
                        height: 500,
                        title: 'Total Enrolled By Facility',
                        renderTo: 'myChart',
                        layout: 'fit',
                        items: {
                                xtype: 'chart',
								theme: 'Fancy',
                                animate: true,
                                shadow: true,
                                store: store,
                                legend: {
                                    position: 'bottom'
                                },
                        axes: [{
                                type: 'Numeric',
                                position: 'bottom',
                                fields: [
                                            #foreach( $program in $programList )
                                                '$program.name.replace(" ","")',
                                            #end                            
                                    ],
                                title: false,
                                grid: true,
                                label: {
                                        renderer: function(v) {
                                        return String(v).replace(/000000$/, 'M');
                                        }
                                },
                                roundToDecimal: false
                                }, 
                                {
                                type: 'Category',
                                position: 'left',
                                fields: ['facility'],
                                title: false
                            }],
            series: [{
                type: 'bar',
                axis: 'bottom',
                gutter: 80,
                xField: 'facility',
                yField: [
                            #foreach( $program in $programList )
                                '$program.name.replace(" ","")',
                            #end
                        ],
                stacked: true,
                tips: {
                    trackMouse: true,
                    width: 65,
                    height: 28,
                    renderer: function(storeItem, item) {
                        this.setTitle(String(item.value[1]));
                    }
                }
            }]
        }
    });
});

</script>
